const require_rolldown_runtime = require('../../_virtual/rolldown_runtime.js');
const require_v1_cloud_functions = require('../cloud-functions.js');


var testLab_exports =  require_rolldown_runtime.__export({
	ClientInfo: () => ClientInfo,
	PROVIDER: () => PROVIDER,
	ResultStorage: () => ResultStorage,
	SERVICE: () => SERVICE,
	TEST_MATRIX_COMPLETE_EVENT_TYPE: () => TEST_MATRIX_COMPLETE_EVENT_TYPE,
	TestMatrix: () => TestMatrix,
	TestMatrixBuilder: () => TestMatrixBuilder,
	_testMatrixWithOpts: () => _testMatrixWithOpts,
	testMatrix: () => testMatrix
});

const PROVIDER = "google.testing";

const SERVICE = "testing.googleapis.com";

const TEST_MATRIX_COMPLETE_EVENT_TYPE = "testMatrix.complete";

function testMatrix() {
	return _testMatrixWithOpts({});
}

function _testMatrixWithOpts(opts) {
	return new TestMatrixBuilder(() => {
		if (!process.env.GCLOUD_PROJECT) {
			throw new Error("process.env.GCLOUD_PROJECT is not set.");
		}
		return "projects/" + process.env.GCLOUD_PROJECT + "/testMatrices/{matrix}";
	}, opts);
}

var TestMatrixBuilder = class {
	
	constructor(triggerResource, options) {
		this.triggerResource = triggerResource;
		this.options = options;
	}
	
	onComplete(handler) {
		const dataConstructor = (raw) => {
			return new TestMatrix(raw.data);
		};
		return require_v1_cloud_functions.makeCloudFunction({
			provider: PROVIDER,
			eventType: TEST_MATRIX_COMPLETE_EVENT_TYPE,
			triggerResource: this.triggerResource,
			service: SERVICE,
			dataConstructor,
			handler,
			options: this.options
		});
	}
};

var TestMatrix = class {
	
	constructor(data) {
		this.testMatrixId = data.testMatrixId;
		this.createTime = data.timestamp;
		this.state = data.state;
		this.outcomeSummary = data.outcomeSummary;
		this.invalidMatrixDetails = data.invalidMatrixDetails;
		this.resultStorage = new ResultStorage(data.resultStorage);
		this.clientInfo = new ClientInfo(data.clientInfo);
	}
};

var ClientInfo = class {
	
	constructor(data) {
		this.name = data?.name || "";
		this.details = {};
		for (const detail of data?.clientInfoDetails || []) {
			this.details[detail.key] = detail.value || "";
		}
	}
};

var ResultStorage = class {
	
	constructor(data) {
		this.gcsPath = data?.googleCloudStorage?.gcsPath;
		this.toolResultsHistoryId = data?.toolResultsHistory?.historyId;
		this.toolResultsExecutionId = data?.toolResultsExecution?.executionId;
		this.resultsUrl = data?.resultsUrl;
	}
};


exports.ClientInfo = ClientInfo;
exports.PROVIDER = PROVIDER;
exports.ResultStorage = ResultStorage;
exports.SERVICE = SERVICE;
exports.TEST_MATRIX_COMPLETE_EVENT_TYPE = TEST_MATRIX_COMPLETE_EVENT_TYPE;
exports.TestMatrix = TestMatrix;
exports.TestMatrixBuilder = TestMatrixBuilder;
exports._testMatrixWithOpts = _testMatrixWithOpts;
Object.defineProperty(exports, 'testLab_exports', {
  enumerable: true,
  get: function () {
    return testLab_exports;
  }
});
exports.testMatrix = testMatrix;
